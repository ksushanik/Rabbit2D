**Промпт для LLM (Версия с Максимальной Помощью, Кролик/Морковь, Механика Запугивания):**

"Привет! Мне нужна твоя **максимально полная помощь** в создании 2D игры-головоломки в **Godot Engine 4.3** с использованием **GDScript**. Я хочу, чтобы ты предоставил(а) не только объяснения, но и **готовые к использованию фрагменты кода** и **очень подробные, пошаговые инструкции для работы с интерфейсом Godot 4.3**, чтобы я мог создать игру с минимальным написанием кода вручную. Пожалуйста, **генерируй полный код для скриптов и функций**, где это возможно. Если что-то нужно сделать в редакторе Godot, опиши **точные шаги**: какие кнопки нажимать, какие узлы добавлять, какие свойства изменять в инспекторе (указывая точные названия свойств и панелей в Godot 4.3).

**Концепция игры:**

*   **Тема:** Милый кролик собирает морковку на уровне.
*   **Перспектива:** 2D вид сверху.
*   **Игровое поле:** Уровень представляет собой сетку (тайловую карту).
*   **Игрок:** Кролик. Управляется игроком.
*   **Цели:** Морковки. Должны быть "съедены" (собраны/уничтожены) кроликом или "напуганы" им.
*   **Препятствия:** Стены (непроходимые тайлы).
*   **Выход:** Нора. Становится активной только после сбора *всех* морковок.
*   **Опасности:** **Ямы.** Если кролик попадает в яму, он проваливается, и игрок проигрывает уровень.

**Ключевая Механика (Очень Важно! Новые правила взаимодействия):**

1.  **Движение Кролика (Скольжение):**
    *   Игрок нажимает клавишу направления (Вверх, Вниз, Влево, Вправо).
    *   Кролик начинает скользить в этом направлении по сетке.
    *   Кролик **не останавливается** на пустой клетке. Он скользит до тех пор, пока не столкнется с:
        *   Стеной (останавливается на клетке *перед* стеной).
        *   Морковкой (останавливается на клетке *перед* морковкой – см. п.2).
        *   Краем карты (если край карты считается препятствием, останавливается на последней клетке).
    *   После остановки кролика *сначала* обрабатываются взаимодействия с морковками (см. п.2), и *только потом* игрок может выбрать новое направление для следующего скольжения.

2.  **Взаимодействие с Морковками:**
    *   **"Поедание" (Прямое столкновение):** Если кролик скользит и препятствием, остановившим его, является морковка, то кролик останавливается на клетке **перед** морковкой. Сразу после остановки морковка "съедается" (исчезает). Кролик остается на клетке, где остановился (т.е. перед тем местом, где была морковка).
    *   **"Запугивание" (Остановка рядом):** Если кролик скользит и останавливается на клетке, которая находится **рядом** (по горизонтали или вертикали) с одной или несколькими морковками (но не сталкивается с ними напрямую), то эти соседние морковки "пугаются".
    *   **Движение Напуганной Морковки:** Напуганная морковка немедленно начинает скользить в направлении **противоположном** от кролика до тех пор, пока не столкнется с препятствием (Стеной или другой морковкой). Она останавливается на клетке *перед* этим препятствием. *Важно: Если напуганная морковка скользит к краю карты без препятствия, она **не** исчезает и **не** проваливает уровень, а просто останавливается на крайней клетке.*
    *   **Цепочка запугиваний:** Если напуганная морковка останавливается рядом с другой морковкой, она *не* пугает её дальше (чтобы избежать сложных цепных реакций, если не указано иное). Запугивает только кролик своей остановкой.

3.  **Достижение Выхода (Норы):**
    *   Если кролик скользит и **останавливается** на клетке с Норой, и *все* морковки на уровне собраны (съедены), уровень считается пройденным.
    *   Если морковки еще остались, Нора действует как **обычная клетка пола** (кролик проскользит по ней или остановится на ней, если это конец его пути, но уровень не будет пройден). Клетка Норы сама по себе не останавливает скольжение.

4.  **Проваливание в Яму:**
    *   Яма - это особый тип клетки на тайлмапе.
    *   Если кролик скользит и **проезжает по** клетке с ямой, он немедленно проваливается в нее и останавливается.
    *   После проваливания игрок проигрывает уровень.
    *   Должен появиться экран с предложением повторить уровень или закончить игру.
    *   Морковка **НЕ** проваливается в яму при запугивании - она перескакивает через нее и продолжает скользить.

**Твоя Задача (LLM) - Максимально Подробно:**

Предоставь мне **полное, пошаговое руководство** по созданию этой игры в Godot 4.3 (GDScript). **Я ожидаю готовые скрипты и точнейшие инструкции для интерфейса.**

1.  **Настройка Проекта:**
    *   Какие точные настройки проекта (через меню `Проект -> Настройки проекта...`) могут быть полезны (например, настройка Input Map, разрешение окна)? **Приведи точные названия разделов и параметров.**
2.  **Структура Сцены:**
    *   **Создание Главной Сцены Уровня (`Level.tscn`):**
        *   Какие узлы добавить (`Node2D` как корень, `TileMap`, `Node2D` контейнер для морковок, экземпляр сцены Кролика)? **Опиши процесс добавления каждого узла через панель "Сцена".**
    *   **Выбор Узла для Кролика:** Рекомендую `Node2D` (или `Sprite2D`) для полного контроля над позицией по сетке. **Предоставь код для этого варианта.**
    *   **Морковки:** Поскольку морковки теперь могут двигаться, их **лучше реализовать как отдельные сцены/узлы** (например, `Carrot.tscn` с `Node2D` или `Sprite2D` в корне), а не просто тайлы. **Опиши создание сцены `Carrot.tscn`.**
3.  **Создание Уровня (TileMap):**
    *   **Настройка TileSet:**
        *   Подробные шаги: Создание `TileSet`, добавление текстуры, настройка `Tile Size`.
        *   Как выделить тайлы Пола, Стены, Норы, Ямы. Добавить Стенам ~~и Норе~~ стандартный слой физики (`Physics Layer 0`). **Укажи, где нажимать.**
        *   Как добавить Custom Data Layers к тайлам Норы (например, "тип: нора") и Ямы (например, "тип: яма"), чтобы отличать их от Стен и Пола в коде. **Покажи, как добавить и присвоить.**
    *   **Размещение:** Как рисовать Стены/Пол/Нору/Яму. Морковки будут размещаться как экземпляры сцены `Carrot.tscn`.
    *   **GDScript для TileMap:** **Предоставь готовые функции** (вероятно, в скрипте главной сцены `Level.gd`) для:
        *   Проверки, является ли тайл стеной (`is_wall`), норой (`is_exit`) или ямой (`is_pit`) по координатам сетки (`map_to_local`, `get_cell_tile_data`).
        *   Получения размеров карты в тайлах.
4.  **Реализация Кролика (`Rabbit.tscn`, `Rabbit.gd`):**
    *   **Создание Сцены:** `Node2D` (или `Sprite2D`) как корень, узел `Sprite2D` для графики.
    *   **Скрипт Кролика:** **Предоставь полный скрипт**, который включает:
        *   Переменные: `grid_pos` (Vector2i), `is_moving` (bool).
        *   Сигнал `move_started(direction)` и сигнал `move_finished(final_grid_pos)`. Кролик сам не будет считать конечную точку, он только инициирует движение и анимируется.
        *   Функцию `animate_move(target_position, duration)`, которая плавно перемещает спрайт с помощью `Tween`.
        *   Функцию `set_grid_position(new_pos)`, которая мгновенно ставит кролика в нужную клетку (и обновляет `grid_pos`).
        *   Функцию для анимации проваливания в яму (`fall_into_pit`).
5.  **Реализация Морковки (`Carrot.tscn`, `Carrot.gd`):**
    *   **Создание Сцены:** `Node2D` (или `Sprite2D`) как корень, узел `Sprite2D` для графики.
    *   **Скрипт Морковки:** **Предоставь полный скрипт**, который включает:
        *   Переменные: `grid_pos` (Vector2i), `is_moving` (bool).
        *   Функцию `scare_and_slide(direction_away_from_rabbit, level_script)`: Эта функция должна рассчитать конечную точку скольжения морковки (используя методы проверки из `level_script` для стен и других морковок) и запустить анимацию движения (`animate_move`).
        *   Функцию `animate_move(target_position, duration)`.
        *   Функцию `set_grid_position(new_pos)`.
        *   Функцию `eat()`, которая запускает анимацию исчезновения и удаляет морковку (`queue_free()`).
6.  **Реализация Логики Уровня (`Level.gd` - скрипт главной сцены):**
    *   **Настройка Input Map:** **Точные шаги:** `Проект -> Настройки проекта... -> Input Map`. Добавить действия `move_up`, `move_down`, `move_left`, `move_right` и привязать клавиши.
    *   **Переменные:** Ссылки на `TileMap`, `Rabbit`, контейнер с морковками. Список или словарь для отслеживания всех морковок и их позиций (`active_carrots`). Счетчик оставшихся морковок (`carrots_remaining`). Состояние (`player_turn`, `carrots_moving`).
    *   **Функция `_ready()`:** Найти узлы, проинициализировать `active_carrots` (собрать все экземпляры морковок), установить `carrots_remaining`.
    *   **Обработка Ввода (`_unhandled_input`):** **Код:** Проверять `Input.is_action_just_pressed()` только если сейчас ход игрока (`state == player_turn`). Вызвать функцию начала хода кролика `start_rabbit_move(direction)`.
    *   **Функция `start_rabbit_move(direction)`:**
        *   Установить состояние `carrots_moving`.
        *   **Рассчитать Конечную Точку Скольжения Кролика:** **Предоставь код** функции `calculate_slide_destination(start_grid_pos, direction)`. Она должна проверять `TileMap` (стены, норы) и **позиции других морковок** (`active_carrots`). Важно: если на пути морковка, вернуть позицию *перед* ней. Также добавить проверку на наличие ямы и обработку случая попадания в яму.
        *   Запустить анимацию движения кролика (`Rabbit.animate_move`).
        *   Подписаться на сигнал `move_finished` от кролика.
    *   **Функция Обработки Окончания Движения Кролика (`_on_rabbit_move_finished(final_grid_pos)`):**
        *   Обновить `Rabbit.grid_pos`.
        *   **Проверить попадание в яму:** Если кролик остановился на клетке с ямой, вызвать функцию `game_over()`.
        *   **Проверить "Поедание":** Была ли морковка на клетке `final_grid_pos + direction` (где `direction` - направление последнего движения)? Если да, найти эту морковку в `active_carrots`, вызвать её метод `eat()`, уменьшить `carrots_remaining`, удалить из `active_carrots`.
        *   **Проверить "Запугивание":** Найти все морковки в `active_carrots`, которые находятся на соседних клетках (`final_grid_pos.distance_to(carrot.grid_pos) == 1`).
        *   Для каждой напуганной морковки вызвать её метод `scare_and_slide(direction_away, self)`, передав направление от кролика и ссылку на скрипт уровня для проверок пути.
        *   Если морковки были напуганы, дождаться окончания их движения (можно использовать сигналы или счетчик движущихся морковок). Если нет - перейти к проверке победы и ходу игрока.
    *   **Функция Обработки Окончания Движения Морковки:** Когда все напуганные морковки закончили движение, проверить условие победы и вернуть состояние в `player_turn`.
    *   **Проверка Победы:** **Код:** Функция `check_win_condition()`. Проверить, если `carrots_remaining == 0` и `Rabbit.grid_pos` совпадает с координатами Норы, то вызвать `go_to_next_level()`.
    *   **Функция Game Over:** **Код:** Функция `game_over()`. Вызывается при проваливании кролика в яму. Показывает экран с выбором повторить уровень или выйти из игры.
    *   **Вспомогательные Функции:**
        *   `is_wall(grid_pos)`: Проверяет `TileMap` на наличие коллизии, игнорируя Нору.
        *   `is_exit(grid_pos)`: Проверяет `TileMap` на наличие тайла с Custom Data `type=exit`.
        *   `is_pit(grid_pos)`: Проверяет `TileMap` на наличие тайла с Custom Data `type=pit`.
        *   `get_carrot_at(grid_pos)`: Ищет морковку в `active_carrots` по координатам.
        *   `is_cell_occupied(grid_pos)`: Проверяет наличие стены ~~, норы~~ или другой морковки.
7.  **Управление Состоянием Игры:**
    *   **Перезапуск Уровня:** **Код:** Функция `restart_level()`, использующая `get_tree().reload_current_scene()`.
    *   **Переход на Следующий Уровень:** **Код:** Базовая функция `go_to_next_level()`, загружающая следующую сцену.
    *   **Экран Game Over:** **Код:** Создать сцену с выбором перезапустить уровень или закончить игру.
8.  **(Опционально) Отмена Хода (Undo):**
    *   Это становится сложнее из-за движения морковок. Предложи простую идею, как можно было бы хранить состояние (позиции кролика и всех морковок) перед ходом, чтобы можно было его восстановить. **Предоставь базовую концепцию и структуру данных.**

Пожалуйста, будь максимально точным(ой) и полным(ой) в своих ответах и коде. Моя цель - собрать игру, следуя твоим инструкциям, с минимальными доработками. **Убедись, что все инструкции и названия в интерфейсе соответствуют Godot 4.3.**

Спасибо!"