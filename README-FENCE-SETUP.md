# Настройка 2.5D эффекта с заборами

## Шаг 1: Настройка Custom Data Layers в тайлсете

1. Откройте `assets/tilemap/new_world.tres` в редакторе Godot:
   - Выберите файл в FileSystem
   - Двойным кликом откройте его

2. Добавьте новый Custom Data Layer:
   - В редакторе тайлсета перейдите на панель "Custom Data" (справа)
   - Нажмите кнопку "+" для добавления нового слоя
   - Назовите слой "fence_blocks"
   - Установите тип "Dictionary"

## Шаг 2: Добавление слоя забора в TileMap

1. Откройте готовую тестовую сцену `scenes/fence_test_level.tscn` или любую другую
   - Готовый уровень уже содержит настроенный TileMap с двумя слоями:
     - Layer 0 (Ground) - основной слой с землёй и стенами
     - Layer 1 (Fence) - слой для заборов с Z-индексом = 10
2. Если вы создаёте новую сцену, убедитесь, что TileMap имеет два слоя:
   - Выберите узел "GroundLayer" (TileMap) 
   - В инспекторе (справа) найдите секцию "Layers" и нажмите кнопку "+" для добавления нового слоя
   - Назовите новый слой "Fence"
   - Установите для нового слоя Z-индекс = 10 (это разместит его над основным слоем)

## Шаг 3: Размещение заборов и настройка блокировок

1. Выберите тайлы забора в вашем тайлсете
2. Переключитесь на слой "Fence" (Layer 1) в редакторе TileMap
3. Разместите заборы на нужных клетках
4. Затем выберите основной слой (Layer 0)
5. Выберите клетки, на которых находятся заборы
6. В инспекторе найдите Custom Data -> fence_blocks
7. Установите значения для блокировки в формате словаря:
   ```gdscript
   {
     "north": true,  # Блокировать движение с севера
     "south": false, # Разрешить движение с юга
     "east": false,  # Разрешить движение с востока
     "west": true    # Блокировать движение с запада
   }
   ```
   **ВАЖНО**: Вводите словарь точно в таком формате, без пробелов между ключами и значениями.
   Например: {"north":true,"south":false,"east":false,"west":true}
   
8. Настраивайте блокировки индивидуально для каждой клетки с забором

## Шаг 4: Активация дополнительного слоя при создании новой сцены

Если вы создаёте новую сцену уровня с нуля:

1. После создания TileMap добавьте новый слой через инспектор
2. Обязательно включите второй слой: выставьте параметр "Enabled" в true
3. Установите Z-index = 10 для слоя забора
4. Убедитесь, что слой правильно называется "Fence" для читаемости кода

## Шаг 5: Проверка работы

1. Запустите игру, открыв тестовую сцену `scenes/fence_test_level.tscn`
2. Проверьте, что кролик правильно останавливается при попытке пройти через забор с заблокированной стороны
3. При этом кролик должен визуально отображаться "за" забором, когда находится на соответствующей клетке (благодаря более высокому Z-индексу слоя заборов)

## Структура блокировок забора

Блокировка движения заборами настраивается отдельно для каждого направления:
- `"north": true` - блокирует движение с севера (сверху) на клетку
- `"south": true` - блокирует движение с юга (снизу) на клетку
- `"east": true` - блокирует движение с востока (справа) на клетку
- `"west": true` - блокирует движение с запада (слева) на клетку

Это позволяет создавать сложные головоломки, где движение разрешено только с определённых сторон забора.

## Отладка

Если у вас возникли проблемы с работой заборов, добавьте отладочный вывод:

```gdscript
# В метод is_blocked_by_fence добавьте:
print("Проверка блокировки из %s в %s: %s" % [from_pos, to_pos, blocks])
```

## Примечания

- Для редактирования значений Custom Data Layer в словаре используйте формат: `{"north": true, "south": false, "east": true, "west": false}`
- Убедитесь, что код проверки блокировки забором (`is_blocked_by_fence` в Level.gd) правильно получает и интерпретирует данные из тайлмапа
- При необходимости вы можете добавить дополнительную отладочную информацию, добавив вывод в консоль через `print()` в методе `is_blocked_by_fence` 