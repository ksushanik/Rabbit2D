# Система выбора уровней

## Обзор
В игру добавлена система выбора конкретных уровней, позволяющая игрокам проходить любой уровень в любом порядке.

## Компоненты системы

### 1. Главное меню (MainMenu.tscn)
- **Расположение**: `scenes/UI/MainMenu.tscn`
- **Скрипт**: `scripts/MainMenu.gd`
- **Функции**:
  - "Начать игру" - запускает игру с первого уровня
  - "Выбор уровня" - открывает меню выбора уровней
  - "Выход" - закрывает игру

### 2. Меню выбора уровней (LevelSelectMenu.tscn)
- **Расположение**: `scenes/UI/LevelSelectMenu.tscn`
- **Скрипт**: `scripts/LevelSelectMenu.gd`
- **Функции**:
  - Отображает кнопки для всех доступных уровней (1-12)
  - Показывает тестовые уровни ("Тест лис", "Тест атаки")
  - Автоматически отключает кнопки для несуществующих уровней
  - Кнопка "Назад в главное меню"

### 3. Обновленный GameManager
- **Новые методы**:
  - `get_level_paths()` - возвращает список путей к уровням
  - `set_current_level(index)` - устанавливает текущий уровень
  - `load_specific_level(index)` - загружает конкретный уровень
  - `get_current_level_number()` - возвращает номер текущего уровня
  - `show_main_menu()` - показывает главное меню

## Навигация

### Запуск игры
1. Игра теперь запускается с главного меню
2. Из главного меню можно:
   - Начать игру с первого уровня
   - Выбрать конкретный уровень
   - Выйти из игры

### Выбор уровня
1. В главном меню нажать "Выбор уровня"
2. Выбрать нужный уровень из сетки кнопок
3. Уровень загружается напрямую

### Возврат в меню
Из любого места в игре можно вернуться в главное меню:
- **Из диалогов смерти**: кнопка "Главное меню"
- **Из экрана победы**: кнопка "Главное меню"

## Структура уровней

### Основные уровни
- `level_1.tscn` - `level_12.tscn`
- Нумерация начинается с 1
- Автоматически определяются как доступные/недоступные

### Тестовые уровни
- `test_fox_level.tscn` - тест физического блокирования лисой
- `test_fox_attack.tscn` - тест анимации атаки лисы

## Технические детали

### Автоматическое определение уровней
```gdscript
# Проверка существования файла уровня
if ResourceLoader.exists(level_paths[i]):
    button.pressed.connect(_on_level_button_pressed.bind(i))
else:
    button.disabled = true
    button.text += "\n(нет)"
```

### Сохранение состояния
- GameManager отслеживает текущий уровень через `current_level_index`
- При выборе уровня устанавливается соответствующий индекс
- Последовательность уровней сохраняется для кнопки "Следующий уровень"

### Интеграция с существующей системой
- Система полностью совместима с существующей логикой прохождения
- Кнопка "Играть снова" в экране победы перезапускает первый уровень
- Клавиша R по-прежнему перезапускает текущий уровень

## Настройка новых уровней

### Добавление уровня
1. Создать файл `scenes/level_X.tscn`
2. Добавить путь в массив `level_paths` в GameManager.gd:
```gdscript
var level_paths: Array[String] = [
    "res://scenes/level_1.tscn",
    "res://scenes/level_2.tscn",
    # ... существующие уровни ...
    "res://scenes/level_X.tscn"  # новый уровень
]
```
3. Уровень автоматически появится в меню выбора

### Добавление тестового уровня
В `LevelSelectMenu.gd` добавить вызов:
```gdscript
_add_test_level_button("Название теста", "res://scenes/test_level.tscn")
```

## Пользовательский опыт

### Преимущества
- **Свобода выбора**: можно проходить уровни в любом порядке
- **Тестирование**: легкий доступ к тестовым уровням
- **Удобство**: быстрый переход между уровнями
- **Отладка**: простое тестирование конкретных уровней

### Навигационные пути
1. **Главное меню** → **Выбор уровня** → **Конкретный уровень**
2. **Главное меню** → **Начать игру** → **Последовательное прохождение**
3. **Любой уровень** → **Диалог смерти/победы** → **Главное меню**

## Совместимость

### Обратная совместимость
- Все существующие уровни работают без изменений
- Логика прохождения уровней не изменена
- Сохранена возможность последовательного прохождения

### Будущие расширения
- Система сохранения прогресса
- Блокировка уровней до прохождения предыдущих
- Статистика прохождения уровней
- Рейтинговая система 